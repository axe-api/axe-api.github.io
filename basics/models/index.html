<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Models | Axe API</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-1HBM031QWE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-1HBM031QWE');
      </script>
    <meta name="description" content="The fastest way to create Rest API, by defining database models and relations.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.009fede8.css" as="style"><link rel="preload" href="/assets/js/app.e401bdcc.js" as="script"><link rel="preload" href="/assets/js/2.c9fec1e4.js" as="script"><link rel="preload" href="/assets/js/21.a9a345c2.js" as="script"><link rel="prefetch" href="/assets/js/10.3ca732c3.js"><link rel="prefetch" href="/assets/js/11.6e1ef068.js"><link rel="prefetch" href="/assets/js/12.da515be1.js"><link rel="prefetch" href="/assets/js/13.5b4654c6.js"><link rel="prefetch" href="/assets/js/14.d2ec3cba.js"><link rel="prefetch" href="/assets/js/15.f642973d.js"><link rel="prefetch" href="/assets/js/16.57a4b858.js"><link rel="prefetch" href="/assets/js/17.55c268b2.js"><link rel="prefetch" href="/assets/js/18.c267f0ba.js"><link rel="prefetch" href="/assets/js/19.33518c90.js"><link rel="prefetch" href="/assets/js/20.dc396ee5.js"><link rel="prefetch" href="/assets/js/22.e607705f.js"><link rel="prefetch" href="/assets/js/23.29319764.js"><link rel="prefetch" href="/assets/js/24.76d5e167.js"><link rel="prefetch" href="/assets/js/25.6f0d6edb.js"><link rel="prefetch" href="/assets/js/26.80581e44.js"><link rel="prefetch" href="/assets/js/27.ec91427f.js"><link rel="prefetch" href="/assets/js/28.8f4627b5.js"><link rel="prefetch" href="/assets/js/29.db034970.js"><link rel="prefetch" href="/assets/js/3.0cb6f05e.js"><link rel="prefetch" href="/assets/js/30.dab50f00.js"><link rel="prefetch" href="/assets/js/31.e3e98325.js"><link rel="prefetch" href="/assets/js/32.1567e6db.js"><link rel="prefetch" href="/assets/js/33.399427b9.js"><link rel="prefetch" href="/assets/js/34.b2aedc1a.js"><link rel="prefetch" href="/assets/js/4.d5a70b0f.js"><link rel="prefetch" href="/assets/js/5.29eb46f3.js"><link rel="prefetch" href="/assets/js/6.3571f1fd.js"><link rel="prefetch" href="/assets/js/7.c56d85ae.js"><link rel="prefetch" href="/assets/js/8.586e27a8.js"><link rel="prefetch" href="/assets/js/9.32fbefad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.009fede8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Axe API</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/axe-api/axe-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/axe-api/axe-magic" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CLI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/cookbooks/" class="nav-link">Cookbooks</a></div><div class="nav-item"><a href="https://sonarcloud.io/dashboard?id=axe-api_axe-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Sonarcloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/axe-api/axe-api/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Releases
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/axe-api/axe-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/axe-api/axe-magic" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CLI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/cookbooks/" class="nav-link">Cookbooks</a></div><div class="nav-item"><a href="https://sonarcloud.io/dashboard?id=axe-api_axe-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Sonarcloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/axe-api/axe-api/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Releases
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Basics</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basics/init/" class="sidebar-link">Initialization</a></li><li><a href="/basics/models/" aria-current="page" class="active sidebar-link">Models</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/basics/models/#what-is-model" class="sidebar-link">What Is Model?</a></li><li class="sidebar-sub-header"><a href="/basics/models/#structure" class="sidebar-link">Structure</a></li><li class="sidebar-sub-header"><a href="/basics/models/#table-name" class="sidebar-link">Table Name</a></li><li class="sidebar-sub-header"><a href="/basics/models/#primary-key" class="sidebar-link">Primary Key</a></li><li class="sidebar-sub-header"><a href="/basics/models/#fillable-fields" class="sidebar-link">Fillable Fields</a></li><li class="sidebar-sub-header"><a href="/basics/models/#validations" class="sidebar-link">Validations</a></li><li class="sidebar-sub-header"><a href="/basics/models/#hidden-fields" class="sidebar-link">Hidden Fields</a></li><li class="sidebar-sub-header"><a href="/basics/models/#serialization" class="sidebar-link">Serialization</a></li><li class="sidebar-sub-header"><a href="/basics/models/#timestamps" class="sidebar-link">Timestamps</a></li><li class="sidebar-sub-header"><a href="/basics/models/#handlers" class="sidebar-link">Handlers</a></li><li class="sidebar-sub-header"><a href="/basics/models/#related-routes" class="sidebar-link">Related Routes</a></li><li class="sidebar-sub-header"><a href="/basics/models/#nested-routes" class="sidebar-link">Nested Routes</a></li><li class="sidebar-sub-header"><a href="/basics/models/#multiple-relation" class="sidebar-link">Multiple Relation</a></li><li class="sidebar-sub-header"><a href="/basics/models/#recursive-routes" class="sidebar-link">Recursive Routes</a></li><li class="sidebar-sub-header"><a href="/basics/models/#middlewares" class="sidebar-link">Middlewares</a></li><li class="sidebar-sub-header"><a href="/basics/models/#ignore" class="sidebar-link">Ignore</a></li></ul></li><li><a href="/basics/handlers/" class="sidebar-link">Handlers</a></li><li><a href="/basics/config/" class="sidebar-link">Configs</a></li><li><a href="/basics/middlewares/" class="sidebar-link">Middlewares</a></li><li><a href="/basics/queries/" class="sidebar-link">Queries</a></li><li><a href="/basics/errors/" class="sidebar-link">Error Handling</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Database</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/testing/" class="sidebar-link">Testing</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="models"><a href="#models" class="header-anchor">#</a> Models</h1> <p>In this chapter, we are going to explain all details about models. There are so many things that we can say, and we are going to. Let's begin!
<strong>In Axe API, models are not well-known ORM models.</strong></p> <h2 id="what-is-model"><a href="#what-is-model" class="header-anchor">#</a> What Is Model?</h2> <p><strong>Model</strong> is the heart of the <strong>Axe API</strong>. There are many things you can do with Models. By adding and changing some configurations, you can decide how the API should work.</p> <p>Some of the model definitions will be used only in the booting process, some of them are in the HTTP handling process. But don't worry, we are going to explain everything with many examples.</p> <h2 id="structure"><a href="#structure" class="header-anchor">#</a> Structure</h2> <p>A model is basically a class that is extended from Model Class. The following example shows the basic model;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>Let's talk about what happens if you define a model like this. Don't think this is a useless model for your API. After you save it, Axe API will analyze the model and will create routes automatically. In this example, the following routes will be ready to use;</p> <table><thead><tr><th>HTTP Method</th> <th>Url</th> <th>Behavior</th></tr></thead> <tbody><tr><td>GET</td> <td><code>api/users</code></td> <td>Paginate all users</td></tr> <tr><td>POST</td> <td><code>api/users</code></td> <td>Create a new user</td></tr> <tr><td>GET</td> <td><code>api/users/:id</code></td> <td>Get the user by id</td></tr> <tr><td>PUT</td> <td><code>api/users/:id</code></td> <td>Update the user by id</td></tr> <tr><td>DELETE</td> <td><code>api/users/:id</code></td> <td>Delete the user by id</td></tr></tbody></table> <p>By adding more getter and functions, you can tell a different story about your API.</p> <div class="custom-block tip"><p>If you send the following request in your local development environment, you will see the API will respond; <a href="http://localhost:3000/api/users" target="_blank" rel="noopener noreferrer">localhost:3000/api/users<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h2 id="table-name"><a href="#table-name" class="header-anchor">#</a> Table Name</h2> <p>With this getter, you can define which name is using in the database table.</p> <p>By default, you don't have to put any table name definition. But again, you may set your table name with <code>table</code> getter. If you don't set a <code>table</code> getter, we will use the Model name as the table name. But there are only one difference; the table name will be converted to plural if your model name is singular.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p>We strongly suggest that to use singular model names in general.</p></div> <h2 id="primary-key"><a href="#primary-key" class="header-anchor">#</a> Primary Key</h2> <p>With this getter, you can define the name of the primary key in the database.</p> <p>The primary key value is <code>id</code> by default. Nevertheless, you may change it as you wish by your model definition, like the following code example;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">primaryKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;uuid&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><h2 id="fillable-fields"><a href="#fillable-fields" class="header-anchor">#</a> Fillable Fields</h2> <p>By default, we don't allow the user to send any data to create or update a record, because of security issues. If you want to allow what kind of data can be filled, you should use <code>fillable</code> getter in your model.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">fillable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;surname&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>In this example, <strong>email</strong>, <strong>name</strong>, <strong>surname</strong> and <strong>age</strong> columns can be editable by users in <strong>CREATE</strong> and <strong>UPDATE</strong> handlers. If you have a field like <strong>my_secret</strong> and you don't want to make it fillable by users, you <strong>shouldn't</strong> add it to this array. Then it will be safe and only editable by yourself.</p> <p>On the other hand, you can decide different fillable column list by the HTTP method type. For example, usually, we don't want to change the email in the profile update request because it takes too many actions such as sending a confirmation email.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">fillable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token constant">POST</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;surname&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token constant">PUT</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;surname&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>Like the code above, changing <strong>email</strong> has more complex logic because of security. So you may not want to make it editable in update actions.</p> <h2 id="validations"><a href="#validations" class="header-anchor">#</a> Validations</h2> <p>Everybody needs to form validation in their API. Axe API uses <a href="https://www.npmjs.com/package/validatorjs" target="_blank" rel="noopener noreferrer">validatorjs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> internally.</p> <p>The thing you should do to define validations is adding a validation method to your model. The validation method should return an object which describes how form validation should be.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">validations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      email<span class="token operator">:</span> <span class="token string">&quot;required|email&quot;</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">&quot;required|max:50&quot;</span><span class="token punctuation">,</span>
      surname<span class="token operator">:</span> <span class="token string">&quot;required|max:50&quot;</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span> <span class="token string">&quot;max:100&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>This form validation method will be triggered before <strong>CREATE</strong> and <strong>UPDATE</strong> handlers.</p> <p>On the other hand, if you want to use different validation rules in <strong>creating</strong> and <strong>updating</strong> a model record, you can use following structure;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">validations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token constant">POST</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        email<span class="token operator">:</span> <span class="token string">&quot;required|email&quot;</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">&quot;required|max:50&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token constant">PUT</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;required|max:50&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>If the form data doesn't provide validation rules, Axe API will respond as a validation error like this;</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;errors&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;The email field is required.&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;The name field is required.&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p>HTTP status code will be 400 (Bad Request) in that HTTP response.</p></div> <h2 id="hidden-fields"><a href="#hidden-fields" class="header-anchor">#</a> Hidden Fields</h2> <p>You may want to hide some columns in your API results when you have some sensitive information such as password hash. In this case, you should use the following getters to define which columns will be hide;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">hiddens</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password_hash&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p>This definition will be used for all queries, even recursive queries too. You can check the <strong>Queries</strong> section to learn more about queries.</p></div> <h2 id="serialization"><a href="#serialization" class="header-anchor">#</a> Serialization</h2> <p>You can use a serialize function in your model definition to hide some values or to create some computed results.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>item<span class="token punctuation">,</span>
      fullname<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>surname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p>As you can see, there is the <code>request</code> object as the second argument. You can use the <code>request</code> object to filter data. For example; you can hide some data from the user by some authorization rules.</p></div> <p>The serialization function will be triggered automatically by all handlers. Also, recursive queries are supported. In this method, you can manipulate all results by your model.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Karl&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;surname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Popper&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fullname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Karl Popper&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="timestamps"><a href="#timestamps" class="header-anchor">#</a> Timestamps</h2> <p>Axe API supports timestamps as default. While you are creating a new database table in your migrations, you can add timestamps with the <a href="http://knexjs.org/#Schema-timestamps" target="_blank" rel="noopener noreferrer">Knex.js helpers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. After that, you don't have to do anything. Axe API will manage your timestamps automatically.</p> <p>You can look at the simple timestamp example for a migration file;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">up</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">knex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> knex<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    table<span class="token punctuation">.</span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    table<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    table<span class="token punctuation">.</span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Axe API use <code>created_at</code> and <code>updated_at</code> columns as default column name. But you can change it and use your naming structure. To do that, you should add the following getters in your model;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">createdAtColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;my_created_at&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">updatedAtColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;my_updated_at&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>If you don't want to use timestamps in a model, you have to return NULL in your timestamp naming getters.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">createdAtColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">updatedAtColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><h2 id="handlers"><a href="#handlers" class="header-anchor">#</a> Handlers</h2> <p>Now we can talk about the routing features of models.</p> <p>As default, all CRUD routes will be generated for a model definition. But, you can decide what route should be generated for the model with the following definition.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> <span class="token constant">HANDLERS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">INSERT</span><span class="token punctuation">,</span> <span class="token constant">SHOW</span><span class="token punctuation">,</span> <span class="token constant">UPDATE</span><span class="token punctuation">,</span> <span class="token constant">PAGINATE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">HANDLERS</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">handlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token constant">INSERT</span><span class="token punctuation">,</span> <span class="token constant">PAGINATE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>With handlers getter, you can select what kind of behavior will be activated for the model. The code above allows only insert and pagination. With this definition, you will get the following routes only;</p> <table><thead><tr><th>HTTP Method</th> <th>Url</th> <th>Handler</th> <th>Behavior</th></tr></thead> <tbody><tr><td>GET</td> <td><code>api/users</code></td> <td>PAGINATE</td> <td>Paginating all records</td></tr> <tr><td>POST</td> <td><code>api/users</code></td> <td>INSERT</td> <td>Creating a new record</td></tr></tbody></table> <p><strong>Handlers</strong> mean what behaviors have does the model. There are very different handlers that models can support. But also, there are many on the roadmap. You can review our the following handlers table;</p> <ul><li><code>INSERT</code>: Creating a new record.</li> <li><code>PAGINATE</code>: Paginating the all record.</li> <li><code>SHOW</code>: Showing one record by id parameter.</li> <li><code>UPDATE</code>: Updating the record by id parameter.</li> <li><code>DELETE</code>: Deleting the record by id parameter.</li></ul> <h2 id="related-routes"><a href="#related-routes" class="header-anchor">#</a> Related Routes</h2> <p>By best practices, usually, we build related paths for models. For example, let's assume we have two tables; <code>users</code> and <code>posts</code> and these tables are related like the following schema;</p> <div style="text-align:center;"><p><img src="/images/routes-01.png" alt="Database Schema"></p></div> <p>In this case, we need routes like this;</p> <table><thead><tr><th>HTTP Method</th> <th>Url</th></tr></thead> <tbody><tr><td>GET</td> <td><code>api/users</code></td></tr> <tr><td>POST</td> <td><code>api/users</code></td></tr> <tr><td>GET</td> <td><code>api/users/:id</code></td></tr> <tr><td>PUT</td> <td><code>api/users/:id</code></td></tr> <tr><td>DELETE</td> <td><code>api/users/:id</code></td></tr> <tr><td>GET</td> <td><code>api/users/:userId/posts</code></td></tr> <tr><td>POST</td> <td><code>api/users/:userId/posts</code></td></tr> <tr><td>GET</td> <td><code>api/users/:userId/posts/:id</code></td></tr> <tr><td>PUT</td> <td><code>api/users/:userId/posts/:id</code></td></tr> <tr><td>DELETE</td> <td><code>api/users/:userId/posts/:id</code></td></tr></tbody></table> <p>Creating routes in <strong>Axe API</strong> like these is very simple. There is only one thing we should do; <strong>defining relationship</strong> between models. For this case, we should have the following model definitions;</p> <p>For <code>app/Models/User.js</code> model file;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token string">&quot;Post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>For <code>app/Models/Post.js</code> model file;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Post<span class="token punctuation">;</span>
</code></pre></div><p>The following routes will be created <strong>automatically</strong> when you create a model definition like this.</p> <ul><li><code>GET api/users</code></li> <li><code>POST api/users</code></li> <li><code>GET api/users/:id</code></li> <li><code>PUT api/users/:id</code></li> <li><code>DELETE api/users/:id</code></li> <li><code>GET api/users/:usedId/posts</code></li> <li><code>POST api/users/:usedId/posts</code></li> <li><code>GET api/users/:usedId/posts/:id</code></li> <li><code>PUT api/users/:usedId/posts/:id</code></li> <li><code>DELETE api/users/:usedId/posts/:id</code></li></ul> <div class="custom-block tip"><p>Literally, you don't need to manage foreign key values in the HTTP requests. Because Axe API knows the relation very well, and it will manage it for you.</p></div> <h2 id="nested-routes"><a href="#nested-routes" class="header-anchor">#</a> Nested Routes</h2> <p>Axe API tracks all of your models. If you define a relationship between multiple models, it will create all related routes. Let's assume you have three models like; User, Post, and Comment. In this case, you will have the following route pattern;</p> <p><code>api/users/:userId/posts/:postId/comments/:id</code></p> <p>Once you define all the relationships between these three models, you will have all related routes.</p> <div class="custom-block tip"><p>Of course, you will not have only one route. If you use default handlers, you will have 15 routes with that kind of relationship.</p></div> <h2 id="multiple-relation"><a href="#multiple-relation" class="header-anchor">#</a> Multiple Relation</h2> <p>In some cases, you need to define multiple relationships to the same table at the same time. Axe API supports this feature. Here, we are going to show you a simple example.</p> <p>Let's assume you have a database schema like this;</p> <div style="text-align:center;"><p><img src="/images/routes-02.png" alt="Database Schema"></p></div> <p>In this case, you have a relationship to a table with two different foreign keys.</p> <p>For <code>app/Models/User.js</code> model file;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token function">ownedPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token string">&quot;Post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;owner_user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">createdPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token string">&quot;Post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create_user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>For <code>app/Models/Post.js</code> model file;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token function">owner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;owner_user_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">creator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create_user_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Post<span class="token punctuation">;</span>
</code></pre></div><p>In this case, you will have the following route schema;</p> <table><thead><tr><th>Url</th></tr></thead> <tbody><tr><td><code>api/users/:id</code></td></tr> <tr><td><code>api/users/:userId/owned-posts/:id</code></td></tr> <tr><td><code>api/users/:userId/created-posts/:id</code></td></tr></tbody></table> <div class="custom-block warning"><p>As you can see, your relation method name is used as a URL path by Axe API.</p></div> <div class="custom-block tip"><p>Again, these are just a demonstration. In this definition, you will have 15 routes.</p></div> <h2 id="recursive-routes"><a href="#recursive-routes" class="header-anchor">#</a> Recursive Routes</h2> <p>Creating a recursive model is very simple with Axe API. Just add the following relationship structure and it is done! You can use a recursive resource in this way.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Category</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token function">categories</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token string">&quot;Category&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;parent_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">category</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string">&quot;Category&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;parent_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When you define a recursive resource like this, you will have the following routes to access the resource;</p> <table><thead><tr><th>HTTP Method</th> <th>Route</th></tr></thead> <tbody><tr><td>GET</td> <td><code>api/categories</code></td></tr> <tr><td>GET</td> <td><code>api/categories/:id</code></td></tr> <tr><td>POST</td> <td><code>api/categories</code></td></tr> <tr><td>PUT</td> <td><code>api/categories/:id</code></td></tr> <tr><td>DELETE</td> <td><code>api/categories/:id</code></td></tr> <tr><td>GET</td> <td><code>api/categories/:parentId/categories</code></td></tr> <tr><td>GET</td> <td><code>api/categories/:parentId/categories/:id</code></td></tr> <tr><td>POST</td> <td><code>api/categories/:parentId/categories</code></td></tr> <tr><td>PUT</td> <td><code>api/categories/:parentId/categories/:id</code></td></tr> <tr><td>DELETE</td> <td><code>api/categories/:parentId/categories/:id</code></td></tr></tbody></table> <div class="custom-block warning"><p>There is a very important point about recursive routes. If you defined a self-recursive relationship with the model itself, it totally works. But, if you created a recursive relationship between multiple models (such as; A -&gt; B -&gt; C -&gt; A), we don't have anything to detect it for now.</p></div> <h2 id="middlewares"><a href="#middlewares" class="header-anchor">#</a> Middlewares</h2> <p>Sometimes, you may want to protect your models by requests. In those cases, you can use model-based middleware. We are expecting you to define basically an <a href="https://expressjs.com/en/guide/writing-middleware.html" target="_blank" rel="noopener noreferrer">Express Middleware<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. To do add a middleware to a model handlers, you should use <code>middlewares</code> getter like the following code;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> <span class="token constant">HANDLERS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">middlewares</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Check anything you want here.</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>As you can see, you should return an array. It has been designed like that because it helps us to add multiple middlewares at the same time. With the code above, your middleware list will be executed in orderly for all allowed handlers.</p> <p>Of course, you can use multiple middleware functions from other files;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> isAdmin<span class="token punctuation">,</span> isLogged <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./../Middlewares/index.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">middlewares</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>isLogged<span class="token punctuation">,</span> isAdmin<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>But that is not enough for us. We aimed to create a very flexible structure for you. That's why, we added a feature that you can add a special middleware function for a special handler.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> <span class="token constant">HANDLERS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> isAdmin<span class="token punctuation">,</span> isLogged <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./../Middlewares/index.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">INSERT</span><span class="token punctuation">,</span> <span class="token constant">PAGINATE</span><span class="token punctuation">,</span> <span class="token constant">UPDATE</span><span class="token punctuation">,</span> <span class="token constant">DELETE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">HANDLERS</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">middlewares</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        handler<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">INSERT</span><span class="token punctuation">,</span> <span class="token constant">PAGINATE</span><span class="token punctuation">,</span> <span class="token constant">UPDATE</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        middleware<span class="token operator">:</span> isLogged<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        handler<span class="token operator">:</span> <span class="token constant">DELETE</span><span class="token punctuation">,</span>
        middleware<span class="token operator">:</span> isAdmin<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>In this example, this second middleware will be executed only for <strong>DELETE</strong> handler. This is a great way to create a very flexible architecture. Also, it helps us to separate common API logic (CRUD) from business logic.</p> <h2 id="ignore"><a href="#ignore" class="header-anchor">#</a> Ignore</h2> <p>In case you don't want to create routes for a model, Axe API provides ignore getter. Using the ignore getter you can block the model for auto-route creation. By default, ignore getter returns false. But you can change the value like the following code;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axe-api&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">ignore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User<span class="token punctuation">;</span>
</code></pre></div><p>With this configuration, <code>User</code> model's routes wouldn't be created automatically.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        
        <a href="/basics/init/" class="prev">
          Initialization
        </a></span> <span class="next"><a href="/basics/handlers/">
          Handlers
        </a>
        
      </span></p></div> </main></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e401bdcc.js" defer></script><script src="/assets/js/2.c9fec1e4.js" defer></script><script src="/assets/js/21.a9a345c2.js" defer></script>
  </body>
</html>
