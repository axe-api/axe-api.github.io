import{_ as s,o as a,c as e,V as n}from"./chunks/framework.233b31c9.js";const C=JSON.parse('{"title":"Rate limiting","description":"","frontmatter":{},"headers":[],"relativePath":"learn/rate-limiting.md","filePath":"learn/rate-limiting.md"}'),l={name:"learn/rate-limiting.md"},t=n(`<h1 id="rate-limiting" tabindex="-1">Rate limiting <a class="header-anchor" href="#rate-limiting" aria-label="Permalink to &quot;Rate limiting&quot;">​</a></h1><p class="description"> Axe API does not provide an internal rate limiter. Nevertheless, we are going to show you an example of how you can add a rate limiter to your application in this section. </p><ul class="intro"><li>You will learn</li><li>What is rate limiting?</li><li>How to add a rate limiter?</li><li>How to store the rate-limiting data?</li></ul><h2 id="getting-started" tabindex="-1">Getting started <a class="header-anchor" href="#getting-started" aria-label="Permalink to &quot;Getting started&quot;">​</a></h2><p><strong>Rate limiting</strong> in REST API refers to the practice of restricting the number of requests a client can make within a specified timeframe. It helps prevent abuse, ensures <strong>fair resource allocation</strong>, and <strong>protects</strong> the API server from <strong>excessive traffic</strong>.</p><p>Rate limits are typically defined as a maximum number of requests per minute, hour, or day. When the limit is exceeded, the server responds with a specific HTTP status code (e.g., <em>429 Too Many Requests</em>), indicating the client has reached the limit.</p><p>Rate limiting can be implemented using various techniques such as token bucket, sliding window, or fixed window algorithms. It promotes API stability, mitigates denial-of-service attacks, and ensures equitable access to resources for all clients while maintaining the overall API performance and availability.</p><p>In this section, we are going to use the <a href="https://www.npmjs.com/package/express-rate-limit" target="_blank" rel="noreferrer">express-rate-limit</a> library as an <a href="https://expressjs.com/en/guide/using-middleware.html" target="_blank" rel="noreferrer">Express Middleware</a>.</p><h2 id="install-dependencies" tabindex="-1">Install dependencies <a class="header-anchor" href="#install-dependencies" aria-label="Permalink to &quot;Install dependencies&quot;">​</a></h2><p>You can use the following commands in the application root folder;</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm install </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">save express</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">rate</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">limit</span></span></code></pre></div><h2 id="integration-with-axe-api" tabindex="-1">Integration with Axe API <a class="header-anchor" href="#integration-with-axe-api" aria-label="Permalink to &quot;Integration with Axe API&quot;">​</a></h2><p>In the <code>app/v1/init.ts</code> file, you can add the following middleware;</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-F43mg" id="tab-sdLnU3D" checked="checked"><label for="tab-sdLnU3D">app/v1/init.ts</label></div><div class="blocks"><div class="language-ts active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Express</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> RateLimitter </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./Middlewares/RateLimitter</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> onBeforeInit </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">RateLimitter</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> onAfterInit </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">onBeforeInit</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">onAfterInit</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span></code></pre></div></div></div><p>After that, you can create the following file;</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-_q5i-" id="tab-27842Lm" checked="checked"><label for="tab-27842Lm">app/v1/Middlewares/RateLimitter.ts</label></div><div class="blocks"><div class="language-ts active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> rateLimit </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">express-rate-limit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">rateLimit</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">windowMs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">60</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 15 minutes</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">max</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// limit each IP to 100 requests per windowMs</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div></div></div><h2 id="storing-the-data" tabindex="-1">Storing the data <a class="header-anchor" href="#storing-the-data" aria-label="Permalink to &quot;Storing the data&quot;">​</a></h2><p><a href="https://www.npmjs.com/package/express-rate-limit" target="_blank" rel="noreferrer">express-rate-limit</a> library supports many store providers such as <a href="https://redis.io/" target="_blank" rel="noreferrer">Redis</a>, <a href="https://memcached.org/" target="_blank" rel="noreferrer">Memcached</a>, or <a href="https://www.mongodb.com/" target="_blank" rel="noreferrer">Mongo</a>. You can use any of them easily.</p><p>In the following example, we are going to show how you can add <strong>Redis</strong> support for the rate limiter.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm install </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">save rate</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">limit</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">redis</span></span></code></pre></div><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-fK9h8" id="tab-qjr7NIb" checked="checked"><label for="tab-qjr7NIb">app/v1/Middlewares/RateLimitter.ts</label></div><div class="blocks"><div class="language-ts active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> RateLimit </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">express-rate-limit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> RedisStore </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rate-limit-redis</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RateLimit</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">store</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RedisStore</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// see Configuration</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">max</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// limit each IP to 100 requests per windowMs</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">delayMs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// disable delaying - full speed until the max limit is reached</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div></div></div><p>You can review the following store libraries;</p><ul><li><a href="https://www.npmjs.com/package/rate-limit-redis" target="_blank" rel="noreferrer">rate-limit-redis</a></li><li><a href="https://npmjs.org/package/rate-limit-memcached" target="_blank" rel="noreferrer">rate-limit-memcached</a></li><li><a href="https://www.npmjs.com/package/rate-limit-mongo" target="_blank" rel="noreferrer">rate-limit-mongo</a></li></ul><h2 id="next-steps" tabindex="-1">Next steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next steps&quot;">​</a></h2><p>In this section, we tried to simplify how you can add your rate-limiting features to the API.</p><p>In the next section, we are going to show how you can write unit test.</p>`,26),o=[t];function p(r,i,c,y,D,F){return a(),e("div",null,o)}const A=s(l,[["render",p]]);export{C as __pageData,A as default};
