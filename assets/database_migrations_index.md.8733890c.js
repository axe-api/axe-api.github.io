import{_ as s,c as n,o as a,a as l}from"./app.98062ff7.js";const F=JSON.parse('{"title":"Migrations","description":"","frontmatter":{},"headers":[{"level":2,"title":"Installation","slug":"installation","link":"#installation","children":[]},{"level":2,"title":"Using CLI","slug":"using-cli","link":"#using-cli","children":[]},{"level":2,"title":"Create Migration","slug":"create-migration","link":"#create-migration","children":[]},{"level":2,"title":"Upgrading","slug":"upgrading","link":"#upgrading","children":[]}],"relativePath":"database/migrations/index.md","lastUpdated":1671908681000}'),o={name:"database/migrations/index.md"},p=l(`<h1 id="migrations" tabindex="-1">Migrations <a class="header-anchor" href="#migrations" aria-hidden="true">#</a></h1><p>Axe API uses <a href="http://knexjs.org/" target="_blank" rel="noreferrer">Knex.js</a> as the query builder. But also, it uses <a href="http://knexjs.org/#Schema" target="_blank" rel="noreferrer">The Schema Builder of Knex.js</a>. You may find more things in the original documentation about the migration than here. But we want to describe some fundamentals about the migration structure.</p><p>First of all, we are using the <code>./migrations</code> directory to keep the migration files. Also, we are using the power of <a href="http://knexjs.org/" target="_blank" rel="noreferrer">Knex.js</a> for migrations.</p><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-hidden="true">#</a></h2><p>To execute the migrations, you need to install the Knex CLI in your development environment;</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knex</span></span>
<span class="line"></span></code></pre></div><p>To test <strong>knex CLI</strong> is accessible, you can use the following command;</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knex</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--version</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Knex</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CLI</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">version:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">0.95.5</span></span>
<span class="line"><span style="color:#FFCB6B;">Knex</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Local</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">version:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">0.95.5</span></span>
<span class="line"></span></code></pre></div><h2 id="using-cli" tabindex="-1">Using CLI <a class="header-anchor" href="#using-cli" aria-hidden="true">#</a></h2><p>The CLI provides multiple commands to use. On the other hand, <a href="http://knexjs.org/" target="_blank" rel="noreferrer">Knex.js</a> uses <a href="https://nodejs.org/api/modules.html#modules_modules_commonjs_modules" target="_blank" rel="noreferrer">CommonJS</a> as the module system. But we are using <a href="https://nodejs.org/api/esm.html#esm_modules_ecmascript_modules" target="_blank" rel="noreferrer">ECMAScript modules</a>. That&#39;s why we should use the <code>--esm</code> option to execute the migration files.</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knex</span></span>
<span class="line"><span style="color:#FFCB6B;">Usage:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cli</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">command</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Options:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">-V,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--version</span><span style="color:#A6ACCD;">                   </span><span style="color:#C3E88D;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">version</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">number</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--debug</span><span style="color:#A6ACCD;">                         </span><span style="color:#C3E88D;">Run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">debugging.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--knexfile</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">               </span><span style="color:#C3E88D;">Specify</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knexfile</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">path.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--knexpath</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">               </span><span style="color:#C3E88D;">Specify</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knex</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">instance.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--cwd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">                    </span><span style="color:#C3E88D;">Specify</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">working</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directory.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--client</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">                 </span><span style="color:#C3E88D;">Set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">client</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">without</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knexfile.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--connection</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">          </span><span style="color:#C3E88D;">Set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">connection</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">without</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knexfile.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--migrations-directory</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">Set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrations</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directory</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">without</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knexfile.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--migrations-table-name</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">Set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrations</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">table</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">without</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knexfile.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--env</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">                    </span><span style="color:#C3E88D;">environment,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">p<wbr>rocess.env.NODE_ENV</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  </span><span style="color:#FFCB6B;">development</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--esm</span><span style="color:#A6ACCD;">                           </span><span style="color:#C3E88D;">Enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ESM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">interop.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--specific</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">               </span><span style="color:#C3E88D;">Specify</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">one</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">seed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">file</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">execute.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">--timestamp-filename-prefix</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">Enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">timestamp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">prefix</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">of</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  </span><span style="color:#FFCB6B;">generated</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">seed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">files.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">-h,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--help</span><span style="color:#A6ACCD;">                      </span><span style="color:#C3E88D;">display</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">help</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">command</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Commands:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">init</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">                          </span><span style="color:#C3E88D;">Create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">fresh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knexfile.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">migrate:make</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">           </span><span style="color:#C3E88D;">Create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">named</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migration</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">file.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">migrate:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">                </span><span style="color:#C3E88D;">Run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrations</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">that</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">have</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yet</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  </span><span style="color:#FFCB6B;">been</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">migrate:up</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[&lt;</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;">                     </span><span style="color:#C3E88D;">Run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">next</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">specified</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  </span><span style="color:#FFCB6B;">migration</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">that</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">has</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yet</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">been</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">migrate:rollback</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">              </span><span style="color:#C3E88D;">Rollback</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">last</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">batch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrations</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  </span><span style="color:#FFCB6B;">performed.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">migrate:down</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[&lt;</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#A6ACCD;">                   </span><span style="color:#C3E88D;">Undo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">last</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">specified</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  </span><span style="color:#FFCB6B;">migration</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">that</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">was</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">already</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">migrate:currentVersion</span><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">View</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">current</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">version</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  </span><span style="color:#FFCB6B;">migration.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">migrate:list</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">migrate:status</span><span style="color:#A6ACCD;">             </span><span style="color:#C3E88D;">List</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrations</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">files</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">with</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  </span><span style="color:#FFCB6B;">status.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">migrate:unlock</span><span style="color:#A6ACCD;">                          </span><span style="color:#C3E88D;">Forcibly</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">unlocks</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrations</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">lock</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  </span><span style="color:#FFCB6B;">table.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">seed:make</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">              </span><span style="color:#C3E88D;">Create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">named</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">seed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">file.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">seed:run</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">                      </span><span style="color:#C3E88D;">Run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">seed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">files.</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">help</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">command</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">display</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">help</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">command</span></span>
<span class="line"></span></code></pre></div><h2 id="create-migration" tabindex="-1">Create Migration <a class="header-anchor" href="#create-migration" aria-hidden="true">#</a></h2><p>To create a new migration file in it, you should use the following command;</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knex</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--esm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrate:make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">User</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Using</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">environment:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">development</span></span>
<span class="line"><span style="color:#FFCB6B;">Created</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Migration:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./migrations/20210515162821_User.js</span></span>
<span class="line"></span></code></pre></div><p>If you look the detail of the file (<code>migrations/20210515162821_User.js</code>), you will see the following code;</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">exports.</span><span style="color:#82AAFF;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">knex</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">exports.</span><span style="color:#82AAFF;">down</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">knex</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"></span></code></pre></div><p>Unfortunately, the CLI created the migration file for CommonJS. We should change it with ESM manually.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">knex</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> down </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">knex</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"></span></code></pre></div><p>And this is the basic structure of our migration files.</p><h2 id="upgrading" tabindex="-1">Upgrading <a class="header-anchor" href="#upgrading" aria-hidden="true">#</a></h2><p>Let&#39;s assume that you&#39;ve written a migration like this;</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">knex</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">knex</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">schema</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createTable</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">users</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">table</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">increments</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">string</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">string</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">email</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unique</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">timestamps</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> down </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">knex</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">knex</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">schema</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dropTable</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">users</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>To execute this migration file, you should execute the following command;</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">knex</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--esm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrate:latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Using</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">environment:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">development</span></span>
<span class="line"><span style="color:#FFCB6B;">Batch</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ran</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">following</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrations:</span></span>
<span class="line"><span style="color:#A6ACCD;">20210515162821_User.js</span></span>
<span class="line"></span></code></pre></div><p>Yay! You created the first database table.</p>`,25),e=[p];function t(r,c,C,y,D,A){return a(),n("div",null,e)}const E=s(o,[["render",t]]);export{F as __pageData,E as default};
